# Jenkins Service - 服务暴露配置

---
# Jenkins Web UI 服务 - NodePort 方式
apiVersion: v1
kind: Service
metadata:
  name: jenkins-service
  namespace: jenkins
  labels:
    app.kubernetes.io/name: jenkins
    app.kubernetes.io/component: controller
  annotations:
    # Prometheus 监控（可选）
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/prometheus"
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: jenkins
    app.kubernetes.io/component: controller
  ports:
    - name: http
      protocol: TCP
      port: 8080
      targetPort: http
      nodePort: 30080  # Jenkins Web UI 端口
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 10800  # 3 小时会话保持

---
# Jenkins Agent 服务 - 用于 JNLP Agent 连接
apiVersion: v1
kind: Service
metadata:
  name: jenkins-agent-service
  namespace: jenkins
  labels:
    app.kubernetes.io/name: jenkins
    app.kubernetes.io/component: agent-listener
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: jenkins
    app.kubernetes.io/component: controller
  ports:
    - name: agent
      protocol: TCP
      port: 50000
      targetPort: agent
      nodePort: 30050  # Jenkins Agent 连接端口

---
# LoadBalancer 服务（可选 - 云环境使用）
# apiVersion: v1
# kind: Service
# metadata:
#   name: jenkins-lb
#   namespace: jenkins
#   labels:
#     app.kubernetes.io/name: jenkins
#     app.kubernetes.io/component: controller
#   annotations:
#     # AWS NLB
#     service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
#     service.beta.kubernetes.io/aws-load-balancer-internal: "true"
#     # GCP
#     # cloud.google.com/load-balancer-type: "Internal"
# spec:
#   type: LoadBalancer
#   selector:
#     app.kubernetes.io/name: jenkins
#     app.kubernetes.io/component: controller
#   ports:
#     - name: http
#       protocol: TCP
#       port: 80
#       targetPort: http
#     - name: https
#       protocol: TCP
#       port: 443
#       targetPort: http

